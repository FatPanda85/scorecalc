<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>活動積分試算</title>
<style>
  body {
    font-family: "Microsoft JhengHei", sans-serif;
    margin: 0;
    background: #f9fafb;
  }
  header {
    background: #2563eb;
    color: white;
    text-align: center;
    padding: 12px 0;
    font-size: 20px;
    font-weight: bold;
  }
  .tabs {
    display: flex;
    overflow-x: auto;
    background: #1e40af;
  }
  .tabs button {
    flex: 1;
    padding: 10px;
    border: none;
    background: #1e40af;
    color: white;
    font-size: 14px;
    cursor: pointer;
  }
  .tabs button.active {
    background: #3b82f6;
  }
  .tab-content {
    display: none;
    padding: 10px;
  }
  .tab-content.active {
    display: block;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 8px;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 6px;
    text-align: center;
  }
  th {
    background: #f1f5f9;
  }
  .total-section {
    margin-top: 10px;
    background: #eef2ff;
    padding: 8px;
    border-radius: 8px;
  }
  .btn-reset {
    background: #ef4444;
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 5px;
  }
  .btn-reset:hover {
    background: #dc2626;
  }
</style>
</head>
<body>

<header>活動積分試算</header>
<div class="tabs" id="tabs"></div>
<div id="tabContainer"></div>

<script>
// === 活動名稱 ===
const activities = [
  "第一次軍備競演",
  "第一次士官計畫",
  "第二次軍備競演",
  "第二次士官計畫",
  "第三次軍備競演",
  "第三次士官計畫",
  "第四次軍備競演",
  "第四次士官計畫",
  "第五次軍備競演",
  "活動1",
  "活動2",
  "活動3"
];

// === 裝備選項 ===
const equips = [
  ["良好", 1125],
  ["良好1星", 1875],
  ["稀有", 3000],
  ["稀有1星", 4500],
  ["史詩", 3230],
  ["史詩T1", 3440],
  ["傳說", 6250],
  ["神話", 2600],
  ["神話T4-3星", 3090],
];

// === 道具資料 ===
const items = [
  ["火晶", 100],
  ["稀有英雄碎片", 15],
  ["史詩英雄碎片", 50],
  ["傳說英雄碎片", 125],
  ["消耗1分鐘加速進行建造", 1],
  ["消耗1分鐘加速進行研究", 1],
  ["消耗1分鐘加速進行士兵訓練、晉升", 1]
];

// === 動態建立頁面 ===
const tabsDiv = document.getElementById("tabs");
const tabContainer = document.getElementById("tabContainer");

activities.forEach((name, idx) => {
  const id = idx + 1;

  // 建立分頁按鈕
  const btn = document.createElement("button");
  btn.textContent = name;
  btn.onclick = () => switchTab(id);
  if (id === 1) btn.classList.add("active");
  tabsDiv.appendChild(btn);

  // 建立分頁內容
  const div = document.createElement("div");
  div.id = "tab" + id;
  div.className = "tab-content" + (id === 1 ? " active" : "");

  // === 內容HTML ===
  div.innerHTML = `
    <h2>${name}</h2>
    <div class="total-section">
      <label>目標積分：</label>
      <input type="number" id="target${id}" placeholder="輸入目標積分" />
    </div>
    <h3>裝備選項（×3倍積分）</h3>
    <table>
      <tr><th>裝備</th><th>選擇</th><th>積分</th></tr>
      ${[1,2,3,4].map(i => `
        <tr>
          <td>裝備${i}</td>
          <td>
            <select class="equip" data-tab="${id}">
              <option value="0">請選擇裝備</option>
              ${equips.map(([name, score]) => 
                `<option value="${score}">${name} (${score})</option>`).join('')}
            </select>
          </td>
          <td class="equip-total">0</td>
        </tr>`).join("")}
    </table>

    <h3>道具</h3>
    <table>
      <tr><th>道具名稱</th><th>數量</th><th>積分</th></tr>
      ${items.map(([item, score]) => `
        <tr>
          <td>${item}</td>
          <td><input type="number" class="qty" data-tab="${id}" data-score="${score}" value="0" min="0"></td>
          <td class="subtotal">0</td>
        </tr>`).join("")}
    </table>

    <div class="total-section">
      <label>總積分：</label><span id="total${id}">0</span><br/>
      <label>差額積分：</label><span id="diff${id}">0</span><br/>
      <button class="btn-reset" onclick="resetTab(${id})">全部重置</button>
    </div>
  `;
  tabContainer.appendChild(div);
});

// === 切換分頁 ===
function switchTab(n) {
  document.querySelectorAll(".tabs button").forEach((btn, i) => {
    btn.classList.toggle("active", i === n - 1);
  });
  document.querySelectorAll(".tab-content").forEach((div, i) => {
    div.classList.toggle("active", i === n - 1);
  });
}

// === 計算積分 ===
document.addEventListener("input", (e) => {
  const tab = e.target.closest(".tab-content");
  if (!tab) return;
  const tabId = tab.id.replace("tab", "");
  updateTab(tabId);
});

function updateTab(tabId) {
  let total = 0;

  // 裝備積分
  document.querySelectorAll(`#tab${tabId} .equip`).forEach(sel => {
    const val = Number(sel.value);
    const subtotal = val * 3;
    sel.closest("tr").querySelector(".equip-total").textContent = subtotal;
    total += subtotal;
  });

  // 道具積分
  document.querySelectorAll(`#tab${tabId} .qty`).forEach(input => {
    const qty = Number(input.value) || 0;
    const score = Number(input.dataset.score);
    const subtotal = qty * score;
    input.closest("tr").querySelector(".subtotal").textContent = subtotal;
    total += subtotal;
  });

  document.getElementById(`total${tabId}`).textContent = total;

  const target = Number(document.getElementById(`target${tabId}`).value) || 0;
  const diff = Math.max(target - total, 0);
  document.getElementById(`diff${tabId}`).textContent = diff;
}

// === 重置功能 ===
function resetTab(id) {
  document.querySelectorAll(`#tab${id} .qty`).forEach(input => input.value = 0);
  document.querySelectorAll(`#tab${id} .subtotal, #tab${id} .equip-total`).forEach(td => td.textContent = 0);
  document.querySelectorAll(`#tab${id} .equip`).forEach(sel => sel.value = 0);
  document.getElementById(`target${id}`).value = "";
  document.getElementById(`total${id}`).textContent = "0";
  document.getElementById(`diff${id}`).textContent = "0";
}
</script>

</body>
</html>
